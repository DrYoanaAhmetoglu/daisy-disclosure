<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI‑Use Disclosure Form (Live Levels)</title>
  <style>
    :root { --gap: 14px; --bg: #0f0f12; --fg: #e9e9ee; --muted:#a9a9b5; --card:#16161b; --line:#2a2a33; --accent:#3a86ff; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background: var(--bg); color: var(--fg); }
    .wrap { max-width: 980px; margin: 0 auto; padding: 28px 20px 44px; }
    h1 { margin: 0 0 8px; font-size: 1.6rem; }
    p.lead { margin: 0 0 18px; color: var(--muted); }
    fieldset { border: 1px solid var(--line); border-radius: 14px; padding: 16px; margin: 18px 0; background: var(--card); }
    legend { padding: 0 8px; color: var(--muted); }
    label { display: block; margin-bottom: 10px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: var(--gap); }
    .levels { display: flex; flex-wrap: wrap; gap: 12px; }
    input[type="text"], select, textarea { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--line); background: #111117; color: var(--fg); }
    textarea { min-height: 120px; }
    .btns { display: flex; gap: 10px; flex-wrap: wrap; margin: 10px 0 0; }
    button { background: var(--accent); color: white; border: none; padding: 10px 14px; border-radius: 10px; cursor: pointer; font-weight: 600; }
    button.secondary { background: #2b2b35; color: var(--fg); }
    .out { border: 1px dashed var(--line); border-radius: 12px; padding: 16px; background: #0b0b10; margin-top: 14px; white-space: pre-wrap; }
    .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; background: #171721; border: 1px solid var(--line); margin-right: 6px; font-size: 12px; color: var(--muted); }
    .muted { color: var(--muted); font-size: 0.95rem; }
    .group { border: 1px solid var(--line); border-radius: 12px; padding: 12px; margin: 10px 0; background: #12121a; }
    .gtitle { font-weight: 700; margin: 0 0 6px; }
    .gdesc { color: var(--muted); margin: 0 0 10px; font-size: 0.95rem; }
    @media (max-width: 760px) { .row { grid-template-columns: 1fr; } }
    .outputs { display: grid; grid-template-columns: 1fr; gap: 16px; }
    .card { border: 1px solid var(--line); border-radius: 12px; padding: 12px; background: #12121a; }
    .card h3 { margin: 0 0 6px; font-size: 1.05rem; }
    .headerline { display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .actions { display:flex; gap:8px; }
    .preview { color: var(--muted); font-size: 0.95rem; margin-top: 6px; }
    .edit-hint { 
      display: inline-block;
      padding: 0 4px;
      border-radius: 6px;
      border: 1px dashed var(--line);
      color: var(--fg);
      background: #0f0f12;
      outline: none;
      cursor: text;
    }
    
    .edit-hint.is-placeholder{
      color: var(--muted);
      background: transparent;
    }
.edit-hint:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(58,134,255,0.25); }
    
  
/* Normalize font size between AI-generated and final statements */
#finalText, #aiText {
  font-size: 1em;
  line-height: 1.45;
}


/* Live editable bracket cues (subtle) */
.edit-hint {
  border-bottom: 1px dotted rgba(0,0,0,0.25);
  padding: 0 2px;
  border-radius: 3px;
}
.edit-hint:focus {
  outline: none;
  background: rgba(0,0,0,0.04);
  border-bottom-color: rgba(0,0,0,0.55);
}
.edit-hint.live-edited {
  background: rgba(0,0,0,0.03);
}
.edit-hint + .live-badge {
  display: none;
  margin-left: 6px;
  font-size: 0.78em;
  color: #666;
}
.edit-hint:focus + .live-badge {
  display: inline;
}



/* --- Alignment fix: align non-question blocks with fieldset content --- */
/* Fieldsets have 16px inner padding; match that offset for top-level text blocks */
.wrap > h1,
.wrap > p.lead {
  padding-left: 16px;
  padding-right: 16px;
}

/* Cards inside fieldsets should align with the fieldset’s inner content */
.card {
  padding: 16px;
}

/* Generated statement / output areas: keep internal edges consistent */
.out {
  padding-left: 16px;
  padding-right: 16px;
}


/* --- Palette v2 (soft contrast, not all white) --- */
:root{
  --bg: #0f172a;            /* slate-900 */
  --panel: #111827;         /* gray-900 */
  --card: #0b1220;          /* deep navy */
  --card2: #0c1a2e;         /* slightly brighter */
  --text: #e5e7eb;          /* gray-200 */
  --muted: #cbd5e1;         /* slate-300 */
  --line: rgba(226,232,240,.18);
  --accent: #38bdf8;        /* sky-400 */
  --accent2: #a78bfa;       /* violet-400 */
  --chip: rgba(56,189,248,.14);
  --shadow: 0 12px 30px rgba(0,0,0,.35);
}

/* Apply palette */
html, body{ background: var(--bg) !important; color: var(--text) !important; }
a{ color: var(--accent) !important; }
.wrap{ background: transparent !important; }

/* Boxes / sections */
fieldset{
  background: var(--panel) !important;
  border: 1px solid var(--line) !important;
  box-shadow: var(--shadow) !important;
}
legend{
  color: var(--muted) !important;
}

/* Group cards (question blocks) */
.group{
  background: var(--card) !important;
  border: 1px solid var(--line) !important;
}

/* Titles & help text */
.gtitle{ color: var(--text) !important; }
.gdesc, .small, .hint, .lead{ color: var(--muted) !important; }

/* Inputs */
input[type="text"], textarea, select{
  background: rgba(255,255,255,.03) !important;
  color: var(--text) !important;
  border: 1px solid var(--line) !important;
}
label{
  color: var(--text) !important;
}
.levels label{
  background: transparent !important;
}
.levels input[type="radio"]:checked + span,
.levels input[type="checkbox"]:checked + span{
  outline: none !important;
}

/* Buttons */
button, .btn, .pill{
  background: var(--chip) !important;
  color: var(--text) !important;
  border: 1px solid rgba(56,189,248,.35) !important;
}
button:hover, .btn:hover{
  border-color: var(--accent) !important;
}

/* Output cards */
.card, .out{
  background: var(--panel) !important;
  border: 1px solid var(--line) !important;
  box-shadow: var(--shadow) !important;
}

/* Subtle focus ring */
:focus-visible{
  outline: 2px solid rgba(56,189,248,.65) !important;
  outline-offset: 2px !important;
}


/* About modal */
.modal { position: fixed; inset: 0; display: none; z-index: 9999; }
.modal.is-open { display: block; }
.modal__backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.55); }
.modal__card {
  position: relative;
  width: min(640px, calc(100% - 32px));
  margin: 8vh auto 0;
  background: #fff;
  color: #111;
  border-radius: 14px;
  padding: 18px 18px 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,.25);
  line-height: 1.4;
}
.modal__actions {
  margin-top: 16px;
  text-align: right;
}
.modal__card button {
  border: 0;
  border-radius: 10px;
  padding: 10px 14px;
  cursor: pointer;
  background: #111;
  color: #fff;
}


/* FIX: Ensure Continue button text is black even when disabled */
.modal__card button,
.modal__card button:disabled {
  color: #000 !important;
  opacity: 1 !important;
}

</style>
</head>
<body>

<!-- About DAISY (Disclosure of AI-Use in Your Writing) (Disclosure of AI-Use in Your Writing) modal -->
<div id="aboutModal" class="modal" aria-hidden="true">
  <div class="modal__backdrop"></div>
  <div class="modal__card" role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
    <h2 id="aboutTitle">About DAISY</h2>
    <p>
      DAISY (Disclosure of AI-Use in Your Writing) is a research prototype for generating editable AI disclosure statements for academic manuscripts.
    </p>
    <p>
      It is part of a research project led by
      <strong>Yoana Ahmetoglu (UCL)</strong>,
      <strong>Marios Constantinidis (CYENS Centre of Excellence)</strong>, and
      <strong>Anna Cox (UCL)</strong>.
    </p>
    <p>
      If you have feedback or questions, please contact
      <a href="mailto:yoana.ahmetoglu@ucl.ac.uk">yoana.ahmetoglu@ucl.ac.uk</a>.
    </p>
    <div class="modal__actions">
      <button id="closeAbout" type="button">Continue</button>
    </div>
  </div>
</div>

  <div class="wrap">
    <h1>AI‑Use Disclosure Form</h1>
<p class="lead"> </p>
    <p class="lead"></p>

    <fieldset>
      <legend></legend>

<div class="helper" style="margin-top: 0.4em;">
  For each activity below, select the level that best reflects how much AI/LLM support was used for that activity. You can  add text in brackets to specify <em>how</em> the AI/LLM was used (e.g., “drafted outlines”, “rewrote sentences”) or <em>which parts</em> of the manuscript it applied to (e.g., “Methods §3.2”, “Figure 2 caption”).
</div>


      <div class="group">
        <p class="gtitle">Language editing / clarity (grammar, paraphrasing)</p>
        <p class="gdesc">Examples: revised sentences for clarity/grammar; simplified wording; improved flow.</p>
        <div class="levels" role="radiogroup" aria-label="Language editing level">
          <label><input type="radio" name="lvl_edit" value="none" checked> None</label>
          <label><input type="radio" name="lvl_edit" value="low"> Low (<span class="edit-hint" contenteditable="true" spellcheck="false">few sentences</span>)</label>
          <label><input type="radio" name="lvl_edit" value="med"> Medium (<span class="edit-hint" contenteditable="true" spellcheck="false">paragraphs/sections</span>)</label>
          <label><input type="radio" name="lvl_edit" value="high"> High (<span class="edit-hint" contenteditable="true" spellcheck="false">most of manuscript</span>)</label>
        </div>
      </div>

      <div class="group">
        <p class="gtitle">Brainstorming or outlining ideas</p>
        <p class="gdesc">Examples: quick title ideas; lists of limitations; section outlines.</p>
        <div class="levels" role="radiogroup" aria-label="Brainstorming level">
          <label><input type="radio" name="lvl_brain" value="none" checked> None</label>
          <label><input type="radio" name="lvl_brain" value="low"> Low (<span class="edit-hint" contenteditable="true" spellcheck="false">quick suggestions</span>)</label>
          <label><input type="radio" name="lvl_brain" value="med"> Medium (<span class="edit-hint" contenteditable="true" spellcheck="false">lists &amp; outlines</span>)</label>
          <label><input type="radio" name="lvl_brain" value="high"> High (<span class="edit-hint" contenteditable="true" spellcheck="false">drafted sections of the manuscript</span>)</label>
        </div>
      </div>

      <div class="group">
        <p class="gtitle">Coding assistance (scripts, analysis, data cleaning)</p>
        <p class="gdesc">Examples: snippets, debugging, analysis code, plots.</p>
        <div class="levels" role="radiogroup" aria-label="Coding assistance level">
          <label><input type="radio" name="lvl_code" value="none" checked> None</label>
          <label><input type="radio" name="lvl_code" value="low"> Low (<span class="edit-hint" contenteditable="true" spellcheck="false">snippets/syntax</span>)</label>
          <label><input type="radio" name="lvl_code" value="med"> Medium (<span class="edit-hint" contenteditable="true" spellcheck="false">adapted existing analysis code</span>)</label>
          <label><input type="radio" name="lvl_code" value="high"> High (<span class="edit-hint" contenteditable="true" spellcheck="false">heavily relied on scripts</span>)</label>
        </div>
      </div>

      <div class="group">
        <p class="gtitle">Analytical support (summarising or transforming research data)</p>
        <p class="gdesc">Examples: summarised transcripts; descriptive stats; draft theme labels.</p>
        <div class="levels" role="radiogroup" aria-label="Analytical support level">
          <label><input type="radio" name="lvl_analysis" value="none" checked> None</label>
          <label><input type="radio" name="lvl_analysis" value="low"> Low (<span class="edit-hint" contenteditable="true" spellcheck="false">single excerpt/transcript</span>)</label>
          <label><input type="radio" name="lvl_analysis" value="med"> Medium (<span class="edit-hint" contenteditable="true" spellcheck="false">multiple datasets/tables</span>)</label>
          <label><input type="radio" name="lvl_analysis" value="high"> High (<span class="edit-hint" contenteditable="true" spellcheck="false">core analytical tasks</span>)</label>
        </div>
      </div>

      <div class="group">
        <p class="gtitle">Figure / table drafting or layout help</p>
        <p class="gdesc">Examples: formatted tables; suggested diagram layouts; labels/captions.</p>
        <div class="levels" role="radiogroup" aria-label="Figure/table help level">
          <label><input type="radio" name="lvl_fig" value="none" checked> None</label>
          <label><input type="radio" name="lvl_fig" value="low"> Low (<span class="edit-hint" contenteditable="true" spellcheck="false">formatting/labels</span>)</label>
          <label><input type="radio" name="lvl_fig" value="med"> Medium (<span class="edit-hint" contenteditable="true" spellcheck="false">draft tables/diagrams</span>)</label>
          <label><input type="radio" name="lvl_fig" value="high"> High (<span class="edit-hint" contenteditable="true" spellcheck="false">most figures/tables</span>)</label>
        </div>
      </div>

      <label>Tools used (names & versions)
        <input id="tools" type="text" placeholder="e.g., ChatGPT (Sept 2025), NotebookLM, Grammarly">
      </label>
      <div class="row">
        <label>Input data shared with tools (if any)
          <input id="dataShared" type="text" placeholder="e.g., de-identified interview snippets; or 'none'">
        </label>
        <label>Safeguards taken
          <input id="safeguards" type="text" placeholder="e.g., de-identification, opt-out from training, institutional approval">
        </label>
      </div>
      <div class="row">
        <label>Human validation steps
          <input id="validation" type="text" placeholder="e.g., author review, cross-checking sources, re-running analysis">
        </label>
        <label>Authorship boundaries
          <input id="boundaries" type="text" placeholder="e.g., models not credited as authors; did not determine study design">
        </label>
      </div>

      <div id="incomplete-note" class="muted" style="margin: 0.25em 0 0.75em; display:none;"></div>
</fieldset>

    <fieldset>
      <legend>Tone & detail</legend>
      <p class="muted" style="margin-top:6px;">
        A specific, activity-level disclosure statement is recommended by many publisher and conference policies. A high-level option is also available if authors judge it more appropriate for their situation.
      </p>
      <div class="row">
<label>Detail level
          <select id="detail">
      <option value="specific" selected>Specific</option>
      <option value="brief">High-level</option>
    </select>

        </label>
      </div>
    

    <div class="btns">
      



<button id="gen">Generate</button>
      <span class="pill" id="status"></span>
    </div>

        <div class="outputs" id="outputs">
      <div class="card">
        <div class="headerline">
          <h3>Generated AI-Use statement</h3>
          <div class="actions">
            <button class="secondary" id="copyDraft">Copy</button>
            <button class="secondary" id="dlDraft">Download .txt</button>
          </div>
        </div>
        <p class="muted">This draft is automatically generated from your selections above. </p>
        <div class="out" id="generatedText"></div>
      </div>

      <div class="card" id="finalCard" style="display:none;">
        <div class="headerline">
          <h3>B. Final author-edited statement</h3>
          <div class="actions">
            <button class="secondary" id="copyFinal">Copy</button>
            <button class="secondary" id="dlFinal">Download .txt</button>
          </div>
        </div>
        <p class="muted">Edit this statement to match your paper and disciplinary norms. </p>
        <textarea id="finalText" class="out" style="min-height: 130px; width:100%;"></textarea>
      </div>
    </div>

    </fieldset>


    </div>

  <script>
    const $ = (id) => document.getElementById(id);

    // Editable "example" placeholders: clear on focus, restore when empty (and never include in output)
    function initEditHintPlaceholders() {
      document.querySelectorAll('.edit-hint[contenteditable="true"]').forEach(span => {
        // Store the original default text once
        if (!span.dataset.defaultText) {
          span.dataset.defaultText = (span.textContent || '').trim();
        }
        // Mark as placeholder initially (since it starts as the default text)
        span.classList.add('is-placeholder');

        span.addEventListener('focus', () => {
          if (span.classList.contains('is-placeholder')) {
            span.textContent = '';
            span.classList.remove('is-placeholder');
          }
        });

        span.addEventListener('blur', () => {
          const t = (span.textContent || '').trim();
          if (t === '') {
            span.textContent = span.dataset.defaultText || '';
            span.classList.add('is-placeholder');
          }
        });

        // If user pastes/inputs and ends up empty, keep it consistent until blur
        span.addEventListener('input', () => {
          const t = (span.textContent || '').trim();
          if (t !== '') span.classList.remove('is-placeholder');
        });
      });
    }


    function sentenceJoin(parts) { return parts.filter(Boolean).join(' '); }


function debounce(fn, wait) {
  let t;
  return function(...args) {
    clearTimeout(t);
    t = setTimeout(() => fn.apply(this, args), wait);
  };
}



function updateIncompleteNote() {
  const note = document.getElementById('incomplete-note');
  if (!note) return;

  // Consider AI "used" if any of the usage-level questions is not "none"
  const lvlNames = ['lvl_edit','lvl_brain','lvl_analysis','lvl_code','lvl_fig'];
  const anyUse = lvlNames.some(n => {
    const v = document.querySelector(`input[name="${n}"]:checked`)?.value || 'none';
    return v !== 'none';
  });

  const toolsEl = document.getElementById('tools');

  // Optional detail fields (recommended)
  const missing = [];
  const dataEl = document.getElementById('dataShared');
  const safeEl = document.getElementById('safeguards');
  const valEl = document.getElementById('validation');
  const bndEl = document.getElementById('boundaries');

  if (dataEl && dataEl.value.trim() === '') missing.push('Inputs provided');
  if (safeEl && safeEl.value.trim() === '') missing.push('Safeguards');
  if (valEl && valEl.value.trim() === '') missing.push('Human validation steps');
  if (bndEl && bndEl.value.trim() === '') missing.push('Boundaries / limitations');

  const toolsMissing = !!(toolsEl && toolsEl.value.trim() === '');

  // Show a note only when AI usage has been indicated above and something is missing
  if (anyUse && (toolsMissing || missing.length)) {
    note.style.display = 'block';

    let msg = '';
    if (toolsMissing) {
      msg += 'Note: If any AI usage has been indicated above, disclosure of the AI tool(s) used is required by journal and publisher AI policies and should not be left blank. ';
    } else {
      msg += 'Note: ';
    }

    if (missing.length) {
      msg += 'The following fields are recommended to provide a clearer and more informative AI disclosure: ' + missing.join('; ') + '.';
    } else {
      // If only the required tools field was missing, no extra sentence needed.
      msg = msg.trim();
    }

    note.textContent = msg.trim();
  } else {
    note.style.display = 'none';
    note.textContent = '';
  }
}


    function venuePreamble(v) {
      switch (v) {
        case 'ACM': return 'In line with emerging ACM guidance on generative AI disclosure,';
        case 'IEEE': return 'Consistent with transparency guidance for authors,';
        case 'APA': return 'In accordance with transparency practices,';
        default: return 'For transparency,';
      }
    }

    function levelLabel(code) {
      if (code === 'low') return 'low';
      if (code === 'med') return 'medium';
      if (code === 'high') return 'high';
      return null; // none
    }

    // Existing: list of uses as "name (level)"
    function collectUsesWithLevels() {
      const map = [
        { name: 'language editing/clarity', group: 'lvl_edit' },
        { name: 'idea brainstorming/outlining', group: 'lvl_brain' },
        { name: 'coding assistance', group: 'lvl_code' },
        { name: 'analytical support', group: 'lvl_analysis' },
        { name: 'figure/table drafting', group: 'lvl_fig' },
        
      ];
      const out = [];
      map.forEach(item => {
        const sel = document.querySelector(`input[name="${item.group}"]:checked`);
        const lvl = sel ? sel.value : 'none';
        const label = levelLabel(lvl);
        if (label) out.push(`${item.name} (${label})`);
      });
      return out;
    }

    // NEW: structured levels so we can interpret patterns
    function collectUseLevelsStructured() {
      const map = [
        { name: 'language editing and clarity', group: 'lvl_edit' },
        { name: 'idea brainstorming and outlining', group: 'lvl_brain' },
        { name: 'coding assistance', group: 'lvl_code' },
        { name: 'analytical support', group: 'lvl_analysis' },
        { name: 'figure and table drafting', group: 'lvl_fig' },
        
      ];
      const out = [];
      map.forEach(item => {
        const sel = document.querySelector(`input[name="${item.group}"]:checked`);
        const lvl = sel ? sel.value : 'none';
        if (lvl !== 'none') {
        const label = sel.closest('label');
        const span = label ? label.querySelector('.edit-hint') : null;
        const hintText = span ? (span.textContent || '').trim() : '';
        const defText = span ? (span.dataset.defaultText || '').trim() : '';
        const hintChanged = hintText !== '' && defText !== '' && hintText !== defText;
        out.push({ name: item.name, level: lvl, hintText, hintChanged });
      }
      });
      return out;
    }

    function oxfordJoin(list) {
      if (list.length <= 1) return list.join('');
      return list.slice(0, -1).join(', ') + ' and ' + list[list.length - 1];
    }

    // NEW: convert internal low/med/high levels into natural-language scope (no labels in output)
    function levelToScopePhrase(level, kind) {
      // kind: 'manuscript', 'work', 'coding', 'analysis', 'figures'
      if (kind === 'manuscript') {
        if (level === 'low') return 'in a few places in the manuscript';
        if (level === 'med') return 'in several sections of the manuscript';
        if (level === 'high') return 'across most of the manuscript';
      }
      if (kind === 'work') {
        if (level === 'low') return 'occasionally';
        if (level === 'med') return 'in several parts of the work';
        if (level === 'high') return 'throughout much of the work';
      }
      if (kind === 'coding') {
        if (level === 'low') return 'for small coding tasks';
        if (level === 'med') return 'for parts of the coding work';
        if (level === 'high') return 'for a substantial portion of the coding work';
      }
      if (kind === 'analysis') {
        if (level === 'low') return 'in a limited capacity';
        if (level === 'med') return 'for parts of the work';
        if (level === 'high') return 'for a substantial portion of the work';
      }
      if (kind === 'figures') {
        if (level === 'low') return 'for a small number of figures or tables';
        if (level === 'med') return 'for several figures or tables';
        if (level === 'high') return 'for most figures or tables';
      }
      // Fallback
      if (level === 'low') return 'occasionally';
      if (level === 'med') return 'in several parts';
      if (level === 'high') return 'across most of the work';
      return '';
    }

    // NEW: build natural-language purpose phrases (no category labels, no "(high/med/low)")
    function buildNaturalPurposePhrases(structuredUses) {
      const phrases = [];
      structuredUses.forEach(u => {
        const hint = (u.hintText || '').trim();
        const useHint = !!u.hintChanged && hint !== '';
        const n = u.name;
        const lvl = u.level;

        if (n === 'language editing and clarity') {
          const base = `improve language and clarity ${levelToScopePhrase(lvl, 'manuscript')}`;
          phrases.push(useHint ? `${base} (${hint})` : base);

        } else if (n === 'idea brainstorming and outlining') {
          // Keep this fairly general; brainstorming may occur at different stages.
          const scope = (lvl === 'low')
            ? 'occasionally'
            : (lvl === 'med')
              ? 'in several parts of the manuscript'
              : 'throughout much of the manuscript';
          const base = `brainstorm and outline ideas ${scope}`;
          phrases.push(useHint ? `${base} (${hint})` : base);

        } else if (n === 'coding assistance') {
          const base = `support coding ${levelToScopePhrase(lvl, 'coding')}`;
          phrases.push(useHint ? `${base} (${hint})` : base);

        } else if (n === 'analytical support') {
          const base = `support analysis ${levelToScopePhrase(lvl, 'analysis')}`;
          phrases.push(useHint ? `${base} (${hint})` : base);

        } else if (n === 'figure and table drafting') {
          const base = `draft or refine figures and tables ${levelToScopePhrase(lvl, 'figures')}`;
          phrases.push(useHint ? `${base} (${hint})` : base);

        } else {
          // Unknown item: use the name as-is
          phrases.push(n);
        }
      });

      // Clean up double spaces, etc.
      return phrases.map(p => p.replace(/\s+/g, ' ').trim());
    }

    // NEW: a brief natural-language overall note (does not list categories or levels)
    function buildOverallUseNote(structuredUses) {
      if (!structuredUses.length) return '';
      const levels = structuredUses.map(u => u.level);
      const hasHigh = levels.includes('high');
      const hasMed = levels.includes('med');
      const hasLow = levels.includes('low');

      if (hasHigh && (hasMed || hasLow)) return '';
      if (hasHigh && !hasMed && !hasLow) return '';
      if (hasMed && hasLow && !hasHigh) return '';
      if (hasMed && !hasHigh && !hasLow) return '';
      if (hasLow && !hasHigh && !hasMed) return '';
      return '';
    }

    // NEW: interpretive note based on low/med/high pattern
    function buildPatternNote(structuredUses) {
      if (!structuredUses.length) return '';

      const high = structuredUses.filter(u => u.level === 'high');
      const med  = structuredUses.filter(u => u.level === 'med');
      const low  = structuredUses.filter(u => u.level === 'low');

      const highNames = oxfordJoin(high.map(u => u.name));
      const medNames  = oxfordJoin(med.map(u => u.name));

      // All high → substantial role overall
      if (high.length && high.length === structuredUses.length) {
        return `AI support formed a substantial part of the workflow for ${highNames}.`;
      }

      // Some high, some other levels → substantial in some areas, lighter elsewhere
      if (high.length) {
        return `AI support was substantial for ${highNames} and lighter for other tasks.`;
      }

      // Only medium levels → moderate role
      if (med.length && !low.length) {
        return 'Overall, AI support played a moderate role across these tasks.';
      }

      // Only low levels → occasional, non-central role
      if (low.length && !med.length) {
        return 'Overall, AI support was occasional and did not play a central role in manuscript preparation.';
      }

      // Mix of medium + low, no high
      if (med.length && low.length) {
        return `AI support provided moderate help for ${medNames} and occasional help for other tasks.`;
      }

      return '';
    }

    // NEW: narrative purposes for acknowledgements (no "(medium)" etc.)
    function buildNarrativePurposes(structuredUses) {
      if (!structuredUses.length) return '';

      const high = structuredUses.filter(u => u.level === 'high').map(u => u.name);
      const med  = structuredUses.filter(u => u.level === 'med').map(u => u.name);
      const low  = structuredUses.filter(u => u.level === 'low').map(u => u.name);

      const nonEmptyLevels = [high.length > 0, med.length > 0, low.length > 0].filter(Boolean).length;

      // Only one level used
      if (nonEmptyLevels === 1) {
        if (high.length) {
          return `for ${oxfordJoin(high)}`;
        }
        if (med.length) {
          return `for ${oxfordJoin(med)}`;
        }
        if (low.length) {
          return `for ${oxfordJoin(low)} (occasional support)`;
        }
      }

      // Multiple levels used
      let text = '';

      if (high.length) {
        text += `primarily for ${oxfordJoin(high)}`;
      } else if (med.length) {
        text += `primarily for ${oxfordJoin(med)}`;
      }

      if (med.length && high.length) {
        text += `, with additional support for ${oxfordJoin(med)}`;
      } else if (med.length && !high.length && low.length) {
        text += `, with additional support for ${oxfordJoin(med)}`;
      }

      if (low.length) {
        text += `${text ? ', and ' : 'with '}occasional support for ${oxfordJoin(low)}`;
      }

      return text;
    }

    function buildBaseParts() {
      const uses = collectUsesWithLevels();
      const structuredUses = collectUseLevelsStructured();

      const tools = ($('tools').value || '').trim();
      const dataShared = ($('dataShared').value || '').trim();
      const safeguards = ($('safeguards').value || '').trim();
      const validation = ($('validation').value || '').trim();
      const boundaries = ($('boundaries').value || '').trim();
      const detail = $('detail').value;

      const pre = 'For transparency,';
      const purposes = oxfordJoin(buildNaturalPurposePhrases(structuredUses));
      const patternNote = '';
      const narrativePurposes = buildNarrativePurposes(structuredUses);

      return {
        uses,
        structuredUses,
        structuredUses,
        tools,
        dataShared,
        safeguards,
        validation,
        boundaries,
        pre,
        detail,
        purposes,
        patternNote,
        narrativePurposes
      };
    }

    function buildNoAI() {
      return 'The authors declare that no AI or large language model tools were used in the preparation of this manuscript.';
    }

    function buildAcknowledgements(parts) {
      const { pre, tools, dataShared, narrativePurposes } = parts;
      if (!parts.uses.length && !tools) return buildNoAI();
      const toolsTxt = tools ? ` (${tools})` : '';
      const dataNote = (!dataShared || /^none$/i.test(dataShared))
        ? 'No personally identifiable data were shared.'
        : 'De-identified materials were used.';

      const purposesClause = narrativePurposes
        ? ` ${narrativePurposes}`
        : '';

      return sentenceJoin([
        pre,
        `the authors used generative AI tools${toolsTxt}${purposesClause}.`,
        dataNote,
        'All outputs were reviewed by the authors.'
      ]);
    }

    // NEW: high-level disclosure purposes (activity names only; no scope/intensity language)
    function buildBriefPurposeList(structuredUses) {
      if (!structuredUses.length) return '';
      const names = structuredUses.map(u => {
        if (u.name === 'language editing and clarity') return 'language editing and clarity';
        if (u.name === 'idea brainstorming and outlining') return 'brainstorming and outlining';
        if (u.name === 'coding assistance') return 'coding assistance';
        if (u.name === 'analytical support') return 'analysis and summarisation';
        if (u.name === 'figure and table drafting') return 'figure and table drafting';
        if (u.name === '') return 'drafting text';
        return u.name;
      });
      return oxfordJoin(names);
    }

    function buildBriefDisclosure(parts) {
      // No detailed fields: do not include tools, inputs, safeguards, validation, boundaries
      const purposes = buildBriefPurposeList(parts.structuredUses || []);
      if (!parts.uses.length && !parts.tools) return buildNoAI();
      const purpTxt = purposes ? ` to support ${purposes}` : '';
      return sentenceJoin([
        parts.pre,
        `the authors used generative AI tools in accordance with relevant publication guidelines${purpTxt}.`,
        `The authors reviewed and edited all AI-assisted content and take full responsibility for the final manuscript.`
      ]);
    }

function buildDisclosure(parts) {
      const { pre, tools, purposes, dataShared, safeguards, validation, boundaries, patternNote } = parts;
      if (!parts.uses.length && !tools) return buildNoAI();
      const toolsTxt = tools ? ` (${tools})` : '';
      const dataTxt = (dataShared || '').trim();
      const safeTxt = (safeguards || '').trim();
      const valTxt = (validation || '').trim();
      const boundsTxt = (boundaries || '').trim();
      const s = [
        pre,
        `the authors used generative AI tools${toolsTxt} to ${purposes}.`,
        patternNote
      ];
      if (dataTxt) s.push(`Inputs provided to these tools: ${dataTxt}.`);
      if (safeTxt) s.push(`Safeguards: ${safeTxt}.`);
      if (valTxt) {
        s.push(`All outputs were reviewed and verified by the authors (${valTxt}).`);
      } else {
        s.push('All outputs were reviewed and verified by the authors.');
      }
      if (boundsTxt) s.push(boundsTxt);
      
      return sentenceJoin(s);

    }

    function buildMethods(parts) {
      const { tools, purposes, dataShared, safeguards, validation, boundaries, patternNote } = parts;
      if (!parts.uses.length && !tools) return buildNoAI();
      const toolsTxt = tools ? tools : '[tools/versions not specified]';
      const dataTxt = (dataShared || '').trim();
      const safeTxt = (safeguards || '').trim();
      const valTxt = (validation || '').trim();
      const boundsTxt = (boundaries || '').trim();
      return sentenceJoin([
        `Generative AI assistance was used for ${purposes} via ${toolsTxt}.`,
        patternNote,
        `Inputs: ${dataTxt} with safeguards: ${safeTxt}.`,
        `Outputs were reviewed and, where relevant, independently replicated or cross-checked (${valTxt}).`,
        boundsTxt
      ]);
    }

    function generateAll() {
      const parts = buildBaseParts();
      const draft = (parts.detail === 'brief') ? buildBriefDisclosure(parts) : buildDisclosure(parts);

      $('generatedText').textContent = draft;

      // Only overwrite the final statement if the author has not started editing it
      const finalEl = $('finalText');
      if (!finalEl.dataset.edited) {
        finalEl.value = draft;
      }

      updateIncompleteNote();
      $('status').textContent = 'Generated';
      setTimeout(() => $('status').textContent = '', 1500);
      }

    // Live updates on any change
    function wireLiveUpdate() {
      const inputs = document.querySelectorAll('input, select, textarea');
      inputs.forEach(el => el.addEventListener('change', generateAll));
      inputs.forEach(el => el.addEventListener('keyup', generateAll));
    }

    function getText(id) {
      const el = $(id);
      if (!el) return '';
      const tag = (el.tagName || '').toUpperCase();
      if (tag === 'TEXTAREA' || tag === 'INPUT') return (el.value || '').trim();
      return (el.textContent || '').trim();
    }

    function copyFrom(id) {
      const txt = getText(id);
      if (!txt) return;
      navigator.clipboard.writeText(txt);
      $('status').textContent = 'Copied';
      setTimeout(() => $('status').textContent = '', 1500);
    }

    function downloadTxt(filename, id) {
      const txt = getText(id);
      const blob = new Blob([txt], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    document.addEventListener('DOMContentLoaded', () => {
      initEditHintPlaceholders();
      wireLiveUpdate();
      generateAll();

      // Make the bracketed guidance text editable without toggling the radio button
      document.querySelectorAll('.edit-hint').forEach(span => {
        if (!span.dataset.defaultText) span.dataset.defaultText = (span.textContent || '').trim();
        // Prevent clicks inside the editable hint from toggling the parent <label>/<input>
        ['click','mousedown','mouseup','pointerdown','pointerup'].forEach(evt => {
          span.addEventListener(evt, (e) => e.stopPropagation());
        

      // Live bracket edits: debounce regeneration so it doesn't fire on every keystroke
      const debouncedRegenerate = debounce(() => {
        $('finalText').dataset.edited = '';
        generateAll();
      }, 300);

      document.querySelectorAll('.edit-hint').forEach(span => {
        span.addEventListener('input', () => {
          span.classList.add('live-edited');
          debouncedRegenerate();
        });
      });

});
        // Make Enter act like "done" (avoids inserting line breaks)
        span.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') { e.preventDefault(); span.blur(); }
        });
      });

    
      $('detail').addEventListener('change', () => { $('finalText').dataset.edited = ''; generateAll(); });

      updateIncompleteNote();
      ['dataShared','safeguards','validation','boundaries'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', updateIncompleteNote);
      });

});
    $('gen').addEventListener('click', generateAll);

    // Track whether the author has started editing the final statement
    $('finalText').addEventListener('input', () => {
      $('finalText').dataset.edited = 'true';
    });

    $('copyDraft').addEventListener('click', () => copyFrom('generatedText'));
    $('dlDraft').addEventListener('click', () => downloadTxt('aid_statement_draft.txt', 'generatedText'));

    $('copyFinal').addEventListener('click', () => copyFrom('finalText'));
    $('dlFinal').addEventListener('click', () => downloadTxt('aid_statement_final.txt', 'finalText'));
  
function isMeaningful(text) {
  if (!text) return false;
  const t = text.trim().toLowerCase();
  if (t === '' || t === 'not specified' || t === 'none' || t === 'few sentences' || t === 'some parts' || t === 'most parts') {
    return false;
  }
  return true;
}


// About DAISY modal: show on load
(function () {
  function openModal() {
    const m = document.getElementById("aboutModal");
    if (!m) return;
    m.classList.add("is-open");
    m.setAttribute("aria-hidden", "false");
  }

  function closeModal() {
    const m = document.getElementById("aboutModal");
    if (!m) return;
    m.classList.remove("is-open");
    m.setAttribute("aria-hidden", "true");
  }

  document.addEventListener("DOMContentLoaded", () => {
    openModal();

    document.getElementById("closeAbout")?.addEventListener("click", closeModal);
    document.querySelector("#aboutModal .modal__backdrop")
      ?.addEventListener("click", closeModal);

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeModal();
    });
  });
})();

</script>




<p class="policy-note"><strong>Note:</strong> Some publishers do not allow certain AI uses, for example generating images (e.g., Emerald). Always check your target journal or publisher’s AI policy for specific guidance on what AI use is aligned with their policies.</p>
</body>
</html>
